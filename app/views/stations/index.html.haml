.row.margin-below
  .col-xs-12
    = link_to 'Übersicht als Excel-File herunterladen', stations_path(format: 'xls')

.row
  .col-sm-4.legend
    %span.label.label-danger !
    Account noch nicht aktivert
    %br
    %span.label.label-warning !
    Noch nicht geboten
  .col-sm-4
  .col-sm-4
    .btn.btn-xs.btn-default.toggle-table-visibility
      Nur Bezugsgruppen

- @stations.each do |station|
  .row
    .col-xs-12
      %h2
        = station.name
    - station.groups.each do |group|
      .col-xs-12
        .panel.panel-info
          .panel-heading
            .row
              .col-xs-4
                = group.name
                = ' (' + to_euro(group.total_offer_minimum) + ')'
              .col-xs-8
                .completion-bar{style: "width: #{group.completion}%"}
                  = group.completion.to_s + '% registriert'
          .panel-body.group-info-header
            = link_to 'Löschen', group_path(group), method: 'delete', data: { confirm: 'Wirklich gesamte Station löschen?' }
          - if group.shares.count > 0
            %table.table.col-xs-12.shares-table.margin-below
              %thead
                %tr
                  %th.col-xs-2 Name
                  %th.col-xs-1 Ernteanteile
                  %th.col-xs-2 Wohlfühl
                  %th.col-xs-2 Medium
                  %th.col-xs-2 Schmerzgrenze
              %tbody
                - group.shares.each do |share|
                  %tr
                    %td.col-xs-2
                      = link_to 'x', share_path(share), method: 'delete', data: { confirm: 'Wirklich gesamte Station löschen?' }
                      = link_to share.name, share_path(share)
                      - if !share.activated
                        %span.label.label-danger !
                      - if share.all_offers.empty?
                        %span.label.label-warning !

                    %td.col-xs-2=share.size
                    - %w[minimum medium maximum].each do |offer|
                      %td.col-xs-2
                        - if share.send("total_offer_#{offer}")
                          %span.label.label-success
                            = to_euro(share.send("total_offer_#{offer}"))
          - else
            %table.table.col-xs-12.shares-table.margin-below
              %thead
                %tr
                  %th Noch kein Ernteanteil registriert

  .row
    = form_for([station, station.groups.build]) do |f|
      .col-md-8
        = f.text_field :name, placeholder: 'Neue Bezugsgruppe', class: 'form-control'
      .col-md-4
        = button_tag('Hinzufügen', type: 'submit', class: 'btn btn-success')
  .row
    .col-xs-12
      %hr

.row
  .col-xs-12
  = form_for(@station) do |f|
    .col-md-8
      = f.text_field :name, placeholder: 'Neue Abholstation', class: 'form-control'
    .col-md-4
      = button_tag('Hinzufügen', type: 'submit', class: 'btn btn-success')
